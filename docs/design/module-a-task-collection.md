# æ¨¡å— Aï¼šè¿ç»´ä»»åŠ¡æ™ºèƒ½æ”¶é›†

## 1. æ¨¡å—æ¦‚è¿°

ä» Lark ç¾¤è‡ªåŠ¨è¯†åˆ«è¿ç»´ä»»åŠ¡è¯·æ±‚ï¼Œè¿›è¡Œæ™ºèƒ½åˆ†æå¹¶ç”Ÿæˆ Jira å·¥å•å»ºè®®ã€‚

### 1.1 æ ¸å¿ƒåŸåˆ™

- âœ… AI ä»…æä¾›å»ºè®®ï¼Œä¸è‡ªåŠ¨åˆ›å»ºå·¥å•
- âœ… æ‰€æœ‰å†³ç­–éœ€äººå·¥ç¡®è®¤
- âœ… å®Œæ•´çš„å®¡è®¡è¿½è¸ª

## 2. å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è¿ç»´ä»»åŠ¡æ”¶é›†æµç¨‹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚  Lark   â”‚ ç¾¤æ¶ˆæ¯ (@è¿ç»´ / å…³é”®è¯)                            â”‚
â”‚  â”‚  æ¶ˆæ¯   â”‚                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                    â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚            N8N Webhook æ¥æ”¶              â”‚                    â”‚
â”‚  â”‚  - éªŒè¯æ¶ˆæ¯æ¥æº                          â”‚                    â”‚
â”‚  â”‚  - åˆ¤æ–­è§¦å‘æ¡ä»¶                          â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                   â”‚                                              â”‚
â”‚                   â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚            Dify AI åˆ†æ                  â”‚                    â”‚
â”‚  â”‚  - åˆ¤æ–­æ˜¯å¦ä¸ºä»»åŠ¡è¯·æ±‚                    â”‚                    â”‚
â”‚  â”‚  - æå–ä»»åŠ¡ä¿¡æ¯                          â”‚                    â”‚
â”‚  â”‚  - ç”Ÿæˆåˆ†é…å»ºè®®                          â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                   â”‚                                              â”‚
â”‚                   â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚          N8N ç”Ÿæˆ Lark ç¡®è®¤å¡ç‰‡          â”‚                    â”‚
â”‚  â”‚  - å±•ç¤ºä»»åŠ¡æ‘˜è¦                          â”‚                    â”‚
â”‚  â”‚  - æä¾›ç¡®è®¤/å¿½ç•¥æŒ‰é’®                     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                   â”‚                                              â”‚
â”‚                   â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚          Leader ç¡®è®¤                     â”‚                    â”‚
â”‚  â”‚  [âœ… ç¡®è®¤åˆ›å»º]  [âŒ å¿½ç•¥]                â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                   â”‚                                              â”‚
â”‚                   â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚          N8N åˆ›å»º Jira Issue             â”‚                    â”‚
â”‚  â”‚  - è°ƒç”¨ Jira API                         â”‚                    â”‚
â”‚  â”‚  - è®°å½•å®¡è®¡æ—¥å¿—                          â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. è§¦å‘æ¡ä»¶

| æ¡ä»¶ç±»å‹ | è§„åˆ™ | ç¤ºä¾‹ |
|----------|------|------|
| @è§¦å‘ | æ¶ˆæ¯ä¸­ @è¿ç»´ æˆ– @è¿ç»´ç»„ | "@è¿ç»´ è¯·å¸®å¿™æ£€æŸ¥æœåŠ¡" |
| å…³é”®è¯è§¦å‘ | åŒ…å«æŒ‡å®šå…³é”®è¯ | "è¯·å¤„ç†"ã€"éœ€è¦æ”¯æ´"ã€"ç´§æ€¥" |
| æŒ‡å®šç¾¤è§¦å‘ | è¿ç»´æ”¯æŒç¾¤çš„æ‰€æœ‰æ¶ˆæ¯ | chat_id = xxx |

## 4. AI åˆ†æè®¾è®¡

### 4.1 Prompt æ¨¡æ¿

```
ä½ æ˜¯ä¸€ä¸ªè¿ç»´ä»»åŠ¡åˆ†æåŠ©æ‰‹ã€‚åˆ†æä»¥ä¸‹æ¶ˆæ¯å†…å®¹ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºè¿ç»´ä»»åŠ¡è¯·æ±‚ã€‚

å¦‚æœæ˜¯ä»»åŠ¡è¯·æ±‚ï¼Œè¯·æå–ä»¥ä¸‹ä¿¡æ¯å¹¶ä»¥ JSON æ ¼å¼è¿”å›ï¼š
- is_task: boolean (æ˜¯å¦ä¸ºä»»åŠ¡è¯·æ±‚)
- confidence: number (ç½®ä¿¡åº¦ 0-1)
- target_system: string (ç›®æ ‡ç³»ç»Ÿåç§°)
- purpose: string (ä»»åŠ¡ç›®çš„)
- urgency: string (ç´§æ€¥ç¨‹åº¦ï¼šé«˜/ä¸­/ä½)
- impact_scope: string (å¯èƒ½å½±å“èŒƒå›´)
- suggested_assignee: string (å»ºè®®åˆ†é…äººï¼Œå¯é€‰)
- assign_reason: string (åˆ†é…ç†ç”±ï¼Œå¯é€‰)

å¦‚æœä¸æ˜¯ä»»åŠ¡è¯·æ±‚ï¼Œè¿”å›ï¼š
{"is_task": false, "reason": "è¯´æ˜åŸå› "}

æ¶ˆæ¯å†…å®¹ï¼š
{message}

å‘é€äººï¼š{sender}
æ—¶é—´ï¼š{timestamp}
```

### 4.2 è¾“å‡ºç¤ºä¾‹

**ä»»åŠ¡è¯·æ±‚ï¼š**

```json
{
  "is_task": true,
  "confidence": 0.92,
  "target_system": "prod-api-01",
  "purpose": "æœåŠ¡é‡å¯",
  "urgency": "ä¸­",
  "impact_scope": "API æœåŠ¡çŸ­æš‚ä¸­æ–­çº¦ 5 åˆ†é’Ÿ",
  "suggested_assignee": "å¼ ä¸‰",
  "assign_reason": "å½“å‰è´Ÿè½½ä½ã€ç†Ÿæ‚‰è¯¥ç³»ç»Ÿ"
}
```

**éä»»åŠ¡è¯·æ±‚ï¼š**

```json
{
  "is_task": false,
  "reason": "è¿™æ˜¯ä¸€æ¡æ—¥å¸¸æ²Ÿé€šæ¶ˆæ¯ï¼Œä¸æ˜¯ä»»åŠ¡è¯·æ±‚"
}
```

## 5. Lark äº¤äº’å¡ç‰‡

### 5.1 å¡ç‰‡ç»“æ„

```json
{
  "config": {"wide_screen_mode": true},
  "header": {
    "title": {"content": "ğŸ“‹ æ–°è¿ç»´ä»»åŠ¡è¯·æ±‚", "tag": "plain_text"},
    "template": "blue"
  },
  "elements": [
    {
      "tag": "div",
      "text": {"content": "**æ¥æº**ï¼š@æå›› äº #è¿ç»´æ”¯æŒç¾¤\n**æ—¶é—´**ï¼š2026-02-01 14:30", "tag": "lark_md"}
    },
    {"tag": "hr"},
    {
      "tag": "div",
      "fields": [
        {"is_short": true, "text": {"content": "**ğŸ“Œ ç³»ç»Ÿ**\nprod-api-01", "tag": "lark_md"}},
        {"is_short": true, "text": {"content": "**ğŸ¯ ç›®çš„**\næœåŠ¡é‡å¯", "tag": "lark_md"}},
        {"is_short": true, "text": {"content": "**âš¡ ç´§æ€¥åº¦**\nä¸­", "tag": "lark_md"}},
        {"is_short": true, "text": {"content": "**ğŸ’¥ å½±å“èŒƒå›´**\nAPI æœåŠ¡çŸ­æš‚ä¸­æ–­", "tag": "lark_md"}}
      ]
    },
    {"tag": "hr"},
    {
      "tag": "div",
      "text": {"content": "**ğŸ‘¤ å»ºè®®åˆ†é…**ï¼šå¼ ä¸‰\n**ğŸ“ åŸå› **ï¼šå½“å‰è´Ÿè½½ä½ã€ç†Ÿæ‚‰è¯¥ç³»ç»Ÿ", "tag": "lark_md"}
    },
    {
      "tag": "action",
      "actions": [
        {"tag": "button", "text": {"content": "âœ… ç¡®è®¤åˆ›å»º", "tag": "plain_text"}, "type": "primary", "value": {"action": "confirm"}},
        {"tag": "button", "text": {"content": "âœï¸ ä¿®æ”¹", "tag": "plain_text"}, "value": {"action": "modify"}},
        {"tag": "button", "text": {"content": "âŒ å¿½ç•¥", "tag": "plain_text"}, "type": "danger", "value": {"action": "ignore"}}
      ]
    }
  ]
}
```

## 6. Jira å·¥å•åˆ›å»º

### 6.1 å­—æ®µæ˜ å°„

| AI è¾“å‡º | Jira å­—æ®µ | ç¤ºä¾‹ |
|---------|-----------|------|
| target_system | Labels | prod-api-01 |
| purpose | Summary | [AI] è¿ç»´ä»»åŠ¡: æœåŠ¡é‡å¯ |
| urgency | Priority | Medium |
| impact_scope | Description | å½±å“èŒƒå›´... |
| suggested_assignee | Assignee | å¼ ä¸‰ |

### 6.2 API è°ƒç”¨

```http
POST /rest/api/3/issue
Content-Type: application/json

{
  "fields": {
    "project": {"key": "OPS"},
    "summary": "[AI] è¿ç»´ä»»åŠ¡: é‡å¯ prod-api-01",
    "description": {
      "type": "doc",
      "version": 1,
      "content": [...]
    },
    "issuetype": {"name": "Task"},
    "assignee": {"accountId": "xxx"},
    "priority": {"name": "Medium"},
    "labels": ["ai-generated", "prod-api-01"]
  }
}
```

## 7. å®¡è®¡æ—¥å¿—

### 7.1 è®°å½•å†…å®¹

| å­—æ®µ | è¯´æ˜ |
|------|------|
| timestamp | æ—¶é—´æˆ³ |
| source_message | åŸå§‹æ¶ˆæ¯ï¼ˆè„±æ•ï¼‰ |
| ai_analysis | AI åˆ†æç»“æœ |
| human_decision | äººå·¥å†³ç­–ï¼ˆconfirm/modify/ignoreï¼‰ |
| operator | æ“ä½œäºº |
| jira_issue | åˆ›å»ºçš„ Jira Issue Key |

### 7.2 è¡¨ç»“æ„

```sql
CREATE TABLE task_audit_log (
    id SERIAL PRIMARY KEY,
    created_at TIMESTAMP DEFAULT NOW(),
    source_chat_id VARCHAR(100),
    source_message_hash VARCHAR(64),
    ai_analysis JSONB,
    human_decision VARCHAR(20),
    operator VARCHAR(100),
    jira_issue_key VARCHAR(50),
    trace_id VARCHAR(100)
);
```

## 8. é…ç½®é¡¹

| é…ç½® | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| TRIGGER_KEYWORDS | è§¦å‘å…³é”®è¯ | è¯·å¤„ç†,éœ€è¦æ”¯æ´,ç´§æ€¥ |
| TARGET_CHAT_IDS | ç›‘æ§çš„ç¾¤ ID | - |
| JIRA_PROJECT_KEY | Jira é¡¹ç›® | OPS |
| CONFIRM_TIMEOUT | ç¡®è®¤è¶…æ—¶(åˆ†é’Ÿ) | 60 |
